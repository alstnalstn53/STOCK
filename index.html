<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Material Studio Portfolio</title>
  <script src="https://s3.tradingview.com/tv.js"></script>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: #f5f5f5;
      color: #111;
    }
    header {
      padding: 20px 32px;
      border-bottom: 1px solid #ddd;
      background: #ffffff;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    header h1 {
      margin: 0;
      font-size: 22px;
      letter-spacing: 0.14em;
      font-weight: 800;
    }
    nav a {
      margin-left: 20px;
      font-size: 13px;
      text-decoration: none;
      color: #444;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }
    nav a:hover { color: #000; }

    .section-title {
      font-size: 18px;
      font-weight: 800;
      margin: 28px 0 14px 0;
      padding: 0 32px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #222;
    }

    table {
      width: calc(100% - 64px);
      margin: 0 32px 24px 32px;
      border-collapse: collapse;
      background: #ffffff;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 14px rgba(0,0,0,0.04);
    }
    thead { position: sticky; top: 62px; z-index: 5; }
    th {
      background: #f1f1f1;
      padding: 11px 10px;
      cursor: pointer;
      text-align: left;
      font-size: 12px;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      border-bottom: 1px solid #ddd;
      white-space: nowrap;
    }
    th.sortable:hover { background: #e7e7e7; }
    th .sort-indicator {
      font-size: 11px;
      margin-left: 4px;
      opacity: 0.7;
    }
    td {
      padding: 10px;
      border-bottom: 1px solid #eee;
      font-size: 13px;
    }
    tr.data-row:hover { background: #fafafa; cursor: pointer; }

    .positive { color: #0b8b3b; font-weight: 600; }
    .negative { color: #c02525; font-weight: 600; }

    .insight-row td {
      padding: 0;
      background: #fafafa;
    }
    .insight-box {
      background: #fafafa;
      padding: 18px 20px 18px 20px;
      border-top: 1px solid #e0e0e0;
      font-size: 14px;
      line-height: 1.5;
    }
    .insight-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 8px;
    }
    .insight-title {
      font-weight: 800;
      font-size: 15px;
    }
    .insight-sector {
      font-size: 12px;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 0.09em;
    }
    .muted { color: #777; font-size: 12px; }
    .insight-body {
      margin-top: 6px;
      margin-bottom: 12px;
      white-space: pre-line;
    }
    .chart-container {
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid #ddd;
      height: 260px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 12px;
      padding: 0 32px 24px 32px;
    }
    .card {
      background: #ffffff;
      border-radius: 10px;
      padding: 12px 14px;
      border: 1px solid #e4e4e4;
      box-shadow: 0 3px 10px rgba(0,0,0,0.03);
    }
    .card-title {
      font-weight: 800;
      font-size: 14px;
      margin-bottom: 4px;
    }
    .card-sub {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: #777;
      margin-bottom: 6px;
    }
    .news-card {
      margin-bottom: 12px;
    }

    #news-container {
      padding: 0 32px 40px 32px;
      max-width: 1100px;
    }
  </style>
</head>
<body>

<header>
  <h1>MATERIAL STUDIO PORTFOLIO</h1>
  <nav>
    <a href="#equities">Equities</a>
    <a href="#crypto">Crypto</a>
    <a href="#fx">FX</a>
    <a href="#news">News</a>
  </nav>
</header>

<!-- ============================
     EQUITIES
============================ -->
<h2 class="section-title" id="equities">Equities</h2>

<table id="stocks-table">
  <thead>
    <tr>
      <th class="sortable" data-sort="name">Name<span class="sort-indicator" id="sort-name"></span></th>
      <th class="sortable" data-sort="price">Price<span class="sort-indicator" id="sort-price"></span></th>
      <th class="sortable" data-sort="change">Change<span class="sort-indicator" id="sort-change"></span></th>
      <th class="sortable" data-sort="percent">%<span class="sort-indicator" id="sort-percent"></span></th>
      <th class="sortable" data-sort="sector">Sector<span class="sort-indicator" id="sort-sector"></span></th>
    </tr>
  </thead>
  <tbody id="stocks-body"></tbody>
</table>

<!-- ============================
     CRYPTO
============================ -->
<h2 class="section-title" id="crypto">Crypto Market (Top 15)</h2>
<div class="grid" id="crypto-grid"></div>

<!-- ============================
     FX
============================ -->
<h2 class="section-title" id="fx">FX Rates (vs KRW)</h2>
<div class="grid" id="fx-grid"></div>

<!-- ============================
     NEWS
============================ -->
<h2 class="section-title" id="news">Market News</h2>
<div id="news-container"></div>

<script>
/* ======================================================
   CONFIG: API KEYS
====================================================== */
const POLYGON_API = "0iKefMr7YqIw6uf_JpP2ZOrshixFvBK4";
const FINNHUB_API = "d4ph189r01qjpnav88m0d4ph189r01qjpnav88mg";

/* ======================================================
   STOCK UNIVERSE (심볼 + 이름 + 대략적 섹터)
   – 섹터는 네가 보기 편하게 크게만 분류함
====================================================== */
const stocks = [
  // A
  { symbol:"AAPL", name:"Apple", sector:"Consumer Tech" },
  { symbol:"ABNB", name:"Airbnb", sector:"Travel / Platform" },
  { symbol:"ADBE", name:"Adobe", sector:"Software / Creative" },
  { symbol:"AG", name:"First Majestic Silver", sector:"Metals / Mining" },
  { symbol:"AGX", name:"Argan", sector:"Engineering / Infrastructure" },
  { symbol:"ALAB", name:"Astera Labs", sector:"AI Interconnect / Chips" },
  { symbol:"ALL", name:"Allstate", sector:"Insurance" },
  { symbol:"AMAT", name:"Applied Materials", sector:"Semi Equipment" },
  { symbol:"AMGN", name:"Amgen", sector:"Biotech" },
  { symbol:"AMZN", name:"Amazon", sector:"Cloud / E-Commerce" },
  { symbol:"ANET", name:"Arista Networks", sector:"Networking / Data Center" },
  { symbol:"ANSS", name:"Ansys", sector:"Simulation Software" },
  { symbol:"APP", name:"AppLovin", sector:"AdTech / Mobile" },
  { symbol:"ARM", name:"Arm Holdings", sector:"IP / CPU Architecture" },
  { symbol:"ASML", name:"ASML", sector:"EUV Lithography" },
  { symbol:"AVGO", name:"Broadcom", sector:"Chips / Networking / Software" },

  // B
  { symbol:"BE", name:"Bloom Energy", sector:"Energy / Fuel Cells" },
  { symbol:"BK", name:"Bank of New York Mellon", sector:"Financials" },
  { symbol:"BLK", name:"BlackRock", sector:"Asset Management" },
  { symbol:"BMNR", name:"BitMine Immersion", sector:"Bitcoin Mining" },
  { symbol:"BSX", name:"Boston Scientific", sector:"MedTech" },
  { symbol:"BTDR", name:"Bitdeer Technologies", sector:"Bitcoin Mining" },

  // C
  { symbol:"CAT", name:"Caterpillar", sector:"Industrial / Machinery" },
  { symbol:"CDNS", name:"Cadence Design Systems", sector:"EDA / Chips" },
  { symbol:"CDNA", name:"CareDx", sector:"Diagnostics" },
  { symbol:"CEG", name:"Constellation Energy", sector:"Power / Utilities" },
  { symbol:"CELH", name:"Celsius Holdings", sector:"Beverages" },
  { symbol:"CL", name:"Colgate-Palmolive", sector:"Consumer Staples" },
  { symbol:"CLSK", name:"CleanSpark", sector:"Bitcoin Mining / Energy" },
  { symbol:"CLS", name:"Celestica", sector:"Electronics Manufacturing / Data Center" },
  { symbol:"COHR", name:"Coherent", sector:"Photonics / Lasers" },
  { symbol:"COIN", name:"Coinbase", sector:"Crypto Exchange" },
  { symbol:"COST", name:"Costco", sector:"Retail" },
  { symbol:"CRDO", name:"Credo Technology", sector:"High-Speed Interconnect" },
  { symbol:"CRM", name:"Salesforce", sector:"SaaS / CRM" },
  { symbol:"CSCO", name:"Cisco Systems", sector:"Networking" },
  { symbol:"AI", name:"C3.ai", sector:"Enterprise AI Software" },
  { symbol:"CRS", name:"Carpenter Technology", sector:"Specialty Metals" },

  // D
  { symbol:"DASH", name:"DoorDash", sector:"Delivery / Platform" },
  { symbol:"DDOG", name:"Datadog", sector:"Observability / SaaS" },
  { symbol:"DE", name:"Deere", sector:"Industrial / Agriculture" },
  { symbol:"DLR", name:"Digital Realty", sector:"Data Center REIT" },
  { symbol:"DHI", name:"D.R. Horton", sector:"Homebuilding" },
  { symbol:"DIS", name:"Walt Disney", sector:"Media / Entertainment" },

  // E
  { symbol:"ETN", name:"Eaton", sector:"Electrical / Power" },
  { symbol:"ETRN", name:"Equitrans Midstream", sector:"Midstream / Pipelines" },
  { symbol:"EW", name:"Edwards Lifesciences", sector:"MedTech" },
  { symbol:"EXAS", name:"Exact Sciences", sector:"Diagnostics" },
  { symbol:"EQIX", name:"Equinix", sector:"Data Center REIT" },

  // F
  { symbol:"FNSR", name:"Fabrinet", sector:"Optics / Manufacturing" }, // ticker in 리스트는 FABR 였지만 실제는 FNSR/FN; 여기선 설명용
  { symbol:"FSLR", name:"First Solar", sector:"Solar / Renewables" },
  { symbol:"FUTU", name:"Futu Holdings", sector:"Online Brokerage" },

  // G
  { symbol:"GE", name:"GE Aerospace", sector:"Aerospace" },
  { symbol:"GEL", name:"Genesis Energy", sector:"Midstream / Pipelines" },
  { symbol:"GEN", name:"Generac", sector:"Backup Power" },
  { symbol:"GME", name:"GameStop", sector:"Retail / Meme" },
  { symbol:"GOOGL", name:"Alphabet (Google)", sector:"Search / Cloud / Ads" },
  { symbol:"GENI", name:"Genius Sports", sector:"Sports Data / Tech" },

  // H
  { symbol:"HPE", name:"Hewlett Packard Enterprise", sector:"Enterprise / Servers" },
  { symbol:"HUT", name:"Hut 8 Mining", sector:"Bitcoin Mining" },

  // I
  { symbol:"IBM", name:"IBM", sector:"Hybrid Cloud / AI" },
  { symbol:"IESC", name:"IES Holdings", sector:"Engineering / Infrastructure" },
  { symbol:"INTC", name:"Intel", sector:"CPUs / Foundry" },
  { symbol:"IONQ", name:"IonQ", sector:"Quantum Computing" },
  { symbol:"ISRG", name:"Intuitive Surgical", sector:"MedTech / Robotics" },
  { symbol:"ITRI", name:"Itron", sector:"Smart Grid / Meters" },
  { symbol:"IVZ", name:"Invesco", sector:"Asset Management" },

  // J
  { symbol:"JBL", name:"Jabil", sector:"Manufacturing / EMS" },
  { symbol:"JNPR", name:"Juniper Networks", sector:"Networking" },

  // K
  { symbol:"KO", name:"Coca-Cola", sector:"Beverages" },
  { symbol:"KTOS", name:"Kratos Defense", sector:"Defense / Drones" },

  // L
  { symbol:"LLY", name:"Eli Lilly", sector:"Pharma / Obesity" },
  { symbol:"LMT", name:"Lockheed Martin", sector:"Defense / Aerospace" },
  { symbol:"LRCX", name:"Lam Research", sector:"Semi Equipment" },
  { symbol:"LOW", name:"Lowe's", sector:"Retail / Home Improvement" },

  // M
  { symbol:"MARA", name:"Marathon Digital", sector:"Bitcoin Mining" },
  { symbol:"MCHP", name:"Microchip Technology", sector:"MCUs / Mixed-Signal" },
  { symbol:"META", name:"Meta Platforms", sector:"Social / AI" },
  { symbol:"MNTK", name:"Montauk Renewables", sector:"Renewable Gas" },
  { symbol:"MRNA", name:"Moderna", sector:"Biotech / mRNA" },
  { symbol:"MRVL", name:"Marvell Technology", sector:"Data Center / 5G Chips" },
  { symbol:"MP", name:"MP Materials", sector:"Rare Earths" },
  { symbol:"MU", name:"Micron Technology", sector:"DRAM / NAND / HBM" },
  { symbol:"MSFT", name:"Microsoft", sector:"Cloud / Productivity / AI" },
  { symbol:"MPW", name:"Medical Properties Trust", sector:"Healthcare REIT" },

  // N
  { symbol:"NET", name:"Cloudflare", sector:"Edge / Security" },
  { symbol:"NEE", name:"NextEra Energy", sector:"Renewables / Utility" },
  { symbol:"NFLX", name:"Netflix", sector:"Streaming" },
  { symbol:"NIO", name:"NIO", sector:"EV" },
  { symbol:"NRIX", name:"Nurix Therapeutics", sector:"Biotech" },
  { symbol:"NOW", name:"ServiceNow", sector:"Workflow / SaaS" },
  { symbol:"NU", name:"Nu Holdings", sector:"Fintech / LatAm" },
  { symbol:"NVDA", name:"NVIDIA", sector:"AI GPUs / Platform" },
  { symbol:"NUE", name:"Nucor", sector:"Steel" },

  // O
  { symbol:"OKLO", name:"Oklo", sector:"SMR / Nuclear" },
  { symbol:"ORCL", name:"Oracle", sector:"Database / Cloud" },
  { symbol:"OTTR", name:"Otter Tail", sector:"Utility / Industrial" },

  // P
  { symbol:"PAGS", name:"PagSeguro", sector:"Fintech / Payments" },
  { symbol:"PANW", name:"Palo Alto Networks", sector:"Cybersecurity" },
  { symbol:"PATH", name:"UiPath", sector:"Automation / RPA" },
  { symbol:"PEP", name:"PepsiCo", sector:"Beverages / Snacks" },
  { symbol:"PH", name:"Parker-Hannifin", sector:"Industrial / Motion Control" },
  { symbol:"PLTR", name:"Palantir", sector:"Data / AI Platform" },
  { symbol:"PNW", name:"Pinnacle West Capital", sector:"Utility" },
  { symbol:"PYPL", name:"PayPal", sector:"Fintech / Payments" },

  // Q
  { symbol:"QCOM", name:"Qualcomm", sector:"Wireless / Chips" },
  { symbol:"QSR", name:"Restaurant Brands Intl.", sector:"QSR / Franchising" },

  // R
  { symbol:"RBLX", name:"Roblox", sector:"Gaming / Platform" },
  { symbol:"RDFN", name:"Redfin", sector:"Real Estate / Platform" },
  { symbol:"RIOT", name:"Riot Platforms", sector:"Bitcoin Mining" },

  // S
  { symbol:"SBUX", name:"Starbucks", sector:"Retail / Coffee" },
  { symbol:"SMCI", name:"Super Micro Computer", sector:"AI Servers" },
  { symbol:"SMR", name:"NuScale Power", sector:"SMR / Nuclear" },
  { symbol:"SITM", name:"SiTime", sector:"Timing / MEMS" },
  { symbol:"SHOP", name:"Shopify", sector:"E-Commerce / SaaS" },
  { symbol:"SNOW", name:"Snowflake", sector:"Data Cloud / SaaS" },
  { symbol:"SOFI", name:"SoFi", sector:"Fintech / Neobank" },
  { symbol:"SPOT", name:"Spotify", sector:"Audio / Streaming" },
  { symbol:"SQ", name:"Block", sector:"Fintech / Payments" },
  { symbol:"STLD", name:"Steel Dynamics", sector:"Steel" },
  { symbol:"STRL", name:"Sterling Infrastructure", sector:"Infrastructure / Construction" },
  { symbol:"STX", name:"Seagate", sector:"Storage / HDD" },
  { symbol:"SWKS", name:"Skyworks", sector:"RF Chips" },

  // T
  { symbol:"TDY", name:"Teledyne Technologies", sector:"Sensors / Imaging" },
  { symbol:"TEAM", name:"Atlassian", sector:"Collaboration / SaaS" },
  { symbol:"TEVA", name:"Teva Pharma", sector:"Generic Pharma" },
  { symbol:"TMO", name:"Thermo Fisher Scientific", sector:"Life Science Tools" },
  { symbol:"TSLA", name:"Tesla", sector:"EV / Energy" },
  { symbol:"TSM", name:"Taiwan Semiconductor", sector:"Foundry" },
  { symbol:"TTMI", name:"TTM Technologies", sector:"PCBs" },
  { symbol:"TWLO", name:"Twilio", sector:"Communications API" },

  // U
  { symbol:"UBER", name:"Uber Technologies", sector:"Mobility / Platform" },
  { symbol:"UPST", name:"Upstart", sector:"AI Credit / Fintech" },

  // V
  { symbol:"VCYT", name:"Veracyte", sector:"Diagnostics" },
  { symbol:"VMC", name:"Vulcan Materials", sector:"Construction Materials" },
  { symbol:"VRTX", name:"Vertex Pharmaceuticals", sector:"Biotech" },
  { symbol:"VRT", name:"Vertiv", sector:"Power / Cooling / Data Center" },
  { symbol:"VZ", name:"Verizon", sector:"Telecom" },

  // W
  { symbol:"WDC", name:"Western Digital", sector:"Storage" },
  { symbol:"WMT", name:"Walmart", sector:"Retail" },
  { symbol:"WTW", name:"Willis Towers Watson", sector:"Insurance / Advisory" },

  // Z
  { symbol:"ZI", name:"ZoomInfo", sector:"Sales Data / SaaS" },
  { symbol:"ZBRA", name:"Zebra Technologies", sector:"Auto-ID / Devices" },
  { symbol:"ZM", name:"Zoom Video", sector:"Collaboration / Video" }
];

/* ======================================================
   COMPANY PROFILES
   – 각 종목 2~5문장 정도로, 역할 + AI/데이터센터/성장 포지션 위주 설명
====================================================== */
const companyProfiles = {
  NVDA: `
NVIDIA는 GPU 기반 병렬 연산과 CUDA 소프트웨어 생태계를 중심으로 AI 인프라를 사실상 표준화한 기업이다.
데이터센터 매출 비중이 대부분을 차지하며, H100·H200·B100·GB200 등 고성능 GPU와 DGX/MGX 레퍼런스 시스템으로 AI 학습·추론 시장을 장악하고 있다.
NVLink·InfiniBand·Spectrum-X 같은 네트워크·스위칭 솔루션까지 제공하면서, 단순 칩 공급을 넘어 전체 AI 서버 스택에 깊게 침투했다.
하이퍼스케일러들의 자체칩(Trainium·TPU 등)과 AI 투자 사이클 둔화가 중장기 리스크지만, CUDA 락인과 폭발적인 모델·데이터 증가가 장기 성장 동력이다.
  `,
  AVGO: `
Broadcom은 데이터센터 스위치용 네트워크 ASIC(Tomahawk·Jericho), 스토리지·네트워킹 칩, RF·무선 칩, 그리고 VMware 인수로 확보한 인프라 소프트웨어를 동시에 보유한 복합 반도체·소프트웨어 기업이다.
AI 데이터센터에서 GPU 클러스터를 연결하는 고속 이더넷 스위칭 칩의 핵심 공급자 역할을 하며, 트래픽·대역폭 증가가 구조적인 성장 요인이다.
반도체와 소프트웨어 비즈니스의 믹스 덕분에 매우 높은 마진과 현금흐름을 유지하고 있고, 고객 맞춤형 ASIC 사업도 확대하고 있다.
NVIDIA의 InfiniBand·Spectrum-X와 경쟁하면서도, 개방형 이더넷 기반 패브릭을 원하는 고객에게는 필수적인 파트너로 자리잡고 있다.
  `,
  ASML: `
ASML은 첨단 반도체 공정에 필요한 EUV(극자외선) 노광장비를 사실상 독점 공급하는 유일한 업체이다.
TSMC·삼성·인텔 등 파운드리가 5nm·3nm·2nm 공정으로 진입하려면 ASML 장비가 필수라서, AI 칩과 HBM 생산 CAPEX와 직결되는 위치에 있다.
장비당 ASP가 수천억 단위로 매우 높고, 고객 기반이 제한적이라 기술·가격 협상력이 극도로 강한 구조이다.
미·중 규제와 반도체 사이클에 따른 CAPEX 변동이 리스크지만, 미세공정과 High-NA EUV 도입으로 장기 수요가 탄탄하다.
  `,
  TSM: `
TSMC는 세계 최대의 순수 파운드리로, NVIDIA·AMD·Apple·Qualcomm·Amazon·Google 등의 고성능 칩을 대량 생산한다.
AI GPU·CPU·가속기·HBM·고속 인터커넥트 칩 대부분이 TSMC의 첨단 공정에서 제조되기 때문에, AI 인프라 CAPEX의 핵심 수혜자다.
첨단 공정 비중이 높아질수록 웨이퍼당 수익성과 마진 구조가 개선되고, 고객 다변화로 의존도 리스크도 관리하고 있다.
지정학적 리스크(대만)와 미국·유럽 공장 투자에 따른 비용 증가가 변수지만, 기술 리더십이 유지되는 한 구조적 성장은 이어질 가능성이 크다.
  `,
  SITM: `
SiTime은 기존 쿼츠(Quartz) 기반 타이밍 부품을 대체하는 MEMS 기반 타이밍·클럭 솔루션을 제공하는 팹리스 반도체 기업이다.
데이터센터 서버·네트워크 장비·5G·자동차·산업용 시스템에서 정밀한 타이밍과 온도 안정성이 중요해질수록 SiTime의 고성능 제품 수요가 증가한다.
MEMS 구조 특성상 충격·온도·진동에 강하고, 프로그래머블한 특성으로 차별화된 설계를 제공해 고부가 가치 포지션을 확보하고 있다.
시장 규모에 비해 아직 기업 사이즈가 작아 수요 변동과 특정 고객 의존도가 리스크지만, 데이터센터·AI 서버 확대로 장기 성장 기회가 크다.
  `,
  CDNS: `
Cadence Design Systems는 칩 설계 자동화(EDA) 소프트웨어와 IP를 제공해 반도체 설계자들이 회로를 설계·시뮬레이션·검증·레이아웃할 수 있게 해주는 핵심 툴 공급자다.
AI·고속 I/O·전력 최적화 등 복잡한 설계가 늘어나면서 EDA 도구에 대한 의존도가 더 커지고 있고, 파운드리와의 협업을 통해 최신 공정을 빠르게 지원한다.
구독·라이선스 기반 비즈니스 모델로 소프트웨어 특유의 높은 마진과 반복 매출 구조를 가진다.
Synopsys·Siemens EDA와 함께 과점 구조를 형성하고 있어, 칩 산업 성장과 함께 안정적인 성장을 이어갈 가능성이 높다.
  `,
  SMCI: `
Super Micro Computer는 AI 서버와 스토리지 시스템을 모듈형·고밀도로 설계해 빠르게 커스터마이징해주는 서버 제조사다.
NVIDIA·AMD·Intel과 긴밀히 협력해 최신 GPU·CPU를 탑재한 AI 서버·랙 솔루션을 시장에 가장 빠른 속도로 공급하는 플레이어 중 하나다.
고밀도·리퀴드 쿨링·GPU 최적화 랙 설계에 강점을 가지고 있어, AI 클러스터 수요가 폭발할수록 높은 성장을 누리고 있다.
다만 하드웨어 특성상 마진 구조는 반도체 설계사보다 낮고, AI 서버 CAPEX 사이클 둔화에 매출 변동성이 커질 수 있다.
  `,
  ANET: `
Arista Networks는 데이터센터·클라우드 환경에서 사용되는 고성능 이더넷 스위치와 EOS 네트워크 운영체제를 제공하는 네트워크 장비 기업이다.
하이퍼스케일 클라우드 고객 비중이 높고, AI 클러스터를 이더넷 기반으로 구성하는 고객에게 필수적인 스위칭 솔루션을 제공한다.
Broadcom의 스위칭 칩 위에 소프트웨어·시스템 통합을 더해 차별화된 안정성과 운영 경험을 만든다.
AI 트래픽·동서 트래픽이 늘어날수록 고대역폭 포트와 차세대 스위치 수요가 증가해 구조적 성장 스토리를 갖는다.
  `,
  VRT: `
Vertiv는 데이터센터용 전력 인프라(UPS, PDU, 분전반)와 냉각 시스템(공랭·수랭), 랙 솔루션을 제공하는 인프라 전문 기업이다.
AI 서버는 랙당 전력 소모와 발열이 커서 고효율 전원 공급과 리퀴드쿨링 등 고급 냉각 솔루션 수요가 급증하고 있고, Vertiv는 이 영역에서 핵심 공급자다.
과거에는 경기 민감형 인프라 기업이었지만, AI 데이터센터 CAPEX 확대로 고성장·고마진 체질로 재평가되고 있다.
전력·쿨링 설비는 GPU보다 교체 주기가 길고, 데이터센터 용량이 장기적으로 증가하는 한 꾸준한 수요가 유지될 가능성이 높다.
  `,
  EQIX: `
Equinix는 글로벌 코로케이션 데이터센터 REIT로, 고객이 서버·네트워크 장비를 입주시켜 사용하는 공간·전력·네트워크 연결을 제공한다.
특히 인터넷·클라우드·통신사들 사이의 상호접속(Interconnect)에 강점이 있어 네트워크 허브 역할을 한다.
AI 시대에도 데이터가 모이고 교환되는 거점으로서 중요성이 유지되며, 엣지·하이브리드 클라우드 수요 증가가 장기 성장 포인트다.
리츠 특성상 금리 환경에 민감하고, 대규모 CAPEX와 전력 비용 관리가 핵심 변수가 된다.
  `,
  DLR: `
Digital Realty는 대규모 하이퍼스케일 데이터센터 캠퍼스에 강점을 가진 글로벌 데이터센터 REIT다.
클라우드 사업자·대형 인터넷 기업·엔터프라이즈 고객에게 장기 임대 형태로 데이터센터 공간과 전력을 제공한다.
AI 워크로드로 데이터센터 전력 수요와 랙당 전력 밀도가 증가하면서, 신규 캠퍼스 개발과 리파워링(전력 증설)이 성장 기회다.
고금리 환경에서는 재무 구조와 배당 부담이 리스크지만, 장기 데이터센터 수요는 지속적으로 늘어날 가능성이 크다.
  `,
  NET: `
Cloudflare는 전 세계에 분산된 엣지 네트워크를 기반으로 CDN, DDoS 방어, DNS, 보안, 엣지 컴퓨팅 서비스를 제공한다.
사용자와 가까운 위치에서 트래픽을 처리하는 구조라 웹·API·게임·SaaS 서비스의 성능과 보안을 동시에 개선해준다.
AI inference도 점점 엣지에서 수행하려는 흐름이 있어, Cloudflare Workers·AI 플랫폼이 이 영역을 노리고 있다.
고성장 SaaS 기업으로 평가받으며, 밸류에이션 변동성이 큰 편이지만 장기적으로 트래픽·보안 수요 증가에 레버리지되는 구조이다.
  `,
  CRDO: `
Credo Technology는 100G~800G급 고속 데이터 전송을 위한 AEC/AOC, DSP, SerDes 솔루션을 제공하는 고속 인터커넥트 전문 반도체 회사다.
데이터센터 랙 간·서버 간·스위치 간에 필요한 초고속·저전력 링크를 제공하며, AI 클러스터의 대역폭 확대와 함께 수요가 늘어나는 구조다.
고객 프로젝트나 특정 세대 전환에 따른 매출 변동성이 존재하고, 경쟁사와의 가격·성능 경쟁이 리스크다.
AI·고속 이더넷·모듈식 데이터센터 전환이 성공적으로 진행되면 니치 시장에서 의미 있는 성장을 기대할 수 있다.
  `,
  ALAB: `
Astera Labs는 CXL·PCIe 기반 메모리·가속기·스토리지 연결을 위한 리타이머·스위치·메모리 컨트롤 솔루션을 제공하는 기업이다.
AI 서버에서 CPU–메모리–가속기 간 데이터 흐름을 최적화하고 확장하는 데 필요한 핵심 인터커넥트 기술을 보유하고 있다.
CXL 생태계가 성공적으로 자리잡고 대규모 채택이 이루어진다면, Astera는 고성장 니치 플레이어로 도약할 수 있다.
아직 시장이 초기 단계라 프로젝트·고객 편차와 기술 선택 리스크가 크지만, 성공 시 레버리지가 매우 큰 구조다.
  `,
  MSFT: `
Microsoft는 Windows·Office·Azure·GitHub·LinkedIn 등 다양한 소프트웨어·클라우드 포트폴리오를 가진 빅테크 기업이다.
Azure 클라우드와 OpenAI 제휴를 통해 Copilot·Azure OpenAI Service 등 AI 기반 서비스·플랫폼을 빠르게 확장하고 있다.
M365·Windows·Dynamics 등 기존 구독형 비즈니스에 AI를 붙여 ARPU를 높이고, 개발자 생태계를 GitHub·VS Code로 묶는 전략을 취한다.
AI 인프라 CAPEX가 매우 크지만, 장기적으로 클라우드·생산성·AI 플랫폼에서 높은 수익성을 유지할 가능성이 크다.
  `,
  AMZN: `
Amazon은 이커머스·로지스틱스·AWS 클라우드·광고 비즈니스를 동시에 운영하는 플랫폼 기업이다.
AWS는 글로벌 1위 클라우드로, NVIDIA GPU와 자체칩 Trainium·Inferentia를 함께 운용하며 AI 인프라 서비스와 모델을 제공한다.
물류·추천·검색·광고 최적화 등 내부 운영 전반에 AI를 활용하면서 효율을 높이고 있고, 광고 사업이 이익 성장의 또 다른 축으로 부상했다.
이커머스 마진 압박과 경쟁, AI·클라우드 CAPEX 부담이 변수지만, 규모·데이터·인프라 측면에서 장기 경쟁력이 강하다.
  `,
  GOOGL: `
Alphabet는 검색·유튜브·안드로이드·GCP·광고를 핵심으로 하는 인터넷·클라우드·AI 플랫폼 기업이다.
TPU 기반의 자체 AI 칩과 Gemini 등 LLM을 보유해 검색·광고·클라우드·워크스페이스 제품에 AI를 깊게 통합하고 있다.
검색 광고 구조 변화가 리스크이지만, AI를 적절히 접목하면 클릭당 가치와 광고 효율을 오히려 높일 수 있는 잠재력이 있다.
GCP는 데이터·AI·오픈소스 친화적인 클라우드로서 성장하고 있으며, 유튜브·클라우드·광고 세 축이 수익을 지탱한다.
  `,
  SNOW: `
Snowflake는 클라우드 기반 데이터 웨어하우스·데이터 클라우드 플랫폼을 제공하며, AWS·Azure·GCP 위에서 멀티 클라우드로 동작한다.
고객이 데이터를 중앙화·정제·공유하고 분석할 수 있게 해주며, 최근에는 Native Apps·AI 기능을 붙여 데이터+AI 플랫폼으로 확장 중이다.
사용량 기반 요금 구조라 데이터·쿼리 사용이 늘어날수록 매출이 증가하는 구조를 갖는다.
경쟁 클라우드(예: Redshift, BigQuery)와의 경쟁과 경기 둔화 시 사용량 감소가 리스크지만, 장기적으로 데이터·AI 결합 수요는 계속 성장할 가능성이 크다.
  `,
  DDOG: `
Datadog은 클라우드 인프라 모니터링, 로그, APM, 보안 등을 통합 제공하는 관측성(observability) 플랫폼이다.
마이크로서비스·컨테이너·서버리스 환경이 복잡해질수록 Datadog의 통합 대시보드와 알림 체계가 중요해진다.
AI 서비스를 포함한 모든 클라우드 기반 워크로드가 결국 모니터링 대상이 되기 때문에, 클라우드·SaaS 성장과 함께 구조적으로 따라가는 비즈니스다.
구독형 고성장 SaaS 기업이라 밸류에이션 변동성이 크지만, 제품 스택 확장으로 고객당 매출 상승 여지가 크다.
  `,
  NOW: `
ServiceNow는 IT·HR·보안·고객 서비스 등 기업 내 다양한 워크플로우를 디지털로 연결하고 자동화하는 플랫폼을 제공한다.
AI와 자연어 처리를 활용해 티켓 분류·요약·자동 응답을 구현하고, Copilot 방식의 경험을 엔터프라이즈 워크플로우에 도입하고 있다.
고객의 디지털 전환·업무 자동화 수요에 기반한 반복 매출 구조로, 업그레이드·모듈 추가를 통해 성장한다.
엔터프라이즈 IT 예산·경기 사이클에 영향을 받지만, 플랫폼 잠금 효과와 높은 고객 유지율을 보유한다.
  `,
  CRM: `
Salesforce는 세일즈·마케팅·서비스·커머스·데이터 클라우드 등 CRM 전반을 아우르는 SaaS 플랫폼이다.
Einstein AI와 데이터 클라우드를 통해 고객 데이터를 통합·분석하고, 영업·마케팅 자동화와 추천 기능을 제공한다.
구독형 매출 구조와 강한 고객 락인을 가지고 있지만, 성장 둔화와 마진 개선 이슈로 재평가를 받는 중이다.
AI 기능을 제대로 상용화하면 기존 고객당 매출 증대와 신규 모듈 판매를 통해 성장 여지가 있다.
  `,
  PLTR: `
Palantir는 Gotham·Foundry·AIP를 통해 정부·국방·산업·금융 등에서 데이터 통합·분석·의사결정 지원 플랫폼을 제공한다.
AIP(AI Platform)를 통해 다양한 LLM과 모델을 실제 운영 현장 시나리오에 연결하고, 워크플로우·권한·보안을 관리한다.
데이터를 단순히 저장·조회하는 수준을 넘어, 정책 결정·운영 최적화·리스크 관리까지 연결하는 고부가 가치 영역에 포지셔닝되어 있다.
정부·국방 계약 특성상 프로젝트 수·규모 변동이 크지만, 상업 고객 비중을 늘리며 비즈니스를 다변화하고 있다.
  `,
  BE: `
Bloom Energy는 고체산화물 연료전지(SOFC)를 기반으로 천연가스·수소 등에서 전기를 생산하는 분산 전력 솔루션을 제공한다.
데이터센터·산업 시설에서 그리드에 의존하지 않는 온사이트 전원으로 사용될 수 있어, 전력 품질·탄소 배출 이슈를 동시에 해결하는 옵션이 된다.
AI 데이터센터의 전력 수요와 에너지 전환 요구가 맞물리면 장기 수혜 가능성이 있지만, 초기 CAPEX와 경제성, 연료 공급이 핵심 변수다.
정책·연료 가격·기술 경쟁 등 복합 리스크를 동반하는 고위험·고잠재력 에너지 테크 기업이다.
  `,
  SMR: `
NuScale Power는 소형 모듈형 원자로(SMR) 설계를 개발하는 회사로, 기존 대형 원전보다 작은 규모·모듈형·표준화된 원자로를 지향한다.
장기적으로 데이터센터·산업단지·원격 지역 등에 24/7 기저부하 전력을 공급하는 역할을 목표로 하고 있어, AI 데이터센터 전원 후보 중 하나다.
규제·인허가·정치적 논쟁·원전 수용성 문제로 상용화까지 시간이 오래 걸릴 수 있고, 프로젝트 지연 리스크가 크다.
하지만 성공 시 에너지·데이터센터·산업 전반에 매우 큰 구조적 기회를 가질 수 있는 테마다.
  `,
  OKLO: `
Oklo는 마이크로 규모의 소형 원자로를 개발해 데이터센터·원격지·산업용 전원 공급을 목표로 하는 초기 단계 원자력 스타트업이다.
기존 대형 원전보다 훨씬 작은 규모·모듈형 설계를 통해 설비를 빠르게 배치하고, 데이터센터와 1:1에 가까운 전원 공급을 지향한다.
기술·규제·사회적 수용성 등의 리스크가 매우 크고, 상용화까지 긴 시간이 필요할 수 있는 하이리스크·하이리턴 테마다.
성공할 경우 AI 데이터센터 전력 문제를 해결하는 핵심 솔루션 중 하나로 부상할 가능성이 있다.
  `,
  CEG: `
Constellation Energy는 원자력 발전 비중이 높은 전력 회사로, 미국에서 큰 규모의 원전 포트폴리오를 운영한다.
데이터센터·산업체와 장기 PPA를 맺을 경우, 탄소중립 목표를 갖는 대형 고객에게 매력적인 전원 옵션을 제공할 수 있다.
AI·클라우드 데이터센터 전력 수요 확대와 탈탄소 정책이 겹치면 성장 기회를 얻지만, 규제·정치·원전 이슈가 리스크다.
유틸리티 특성상 안정적 캐시플로우를 바탕으로 하되, 성장 스토리는 정책·전력 수요에 크게 좌우된다.
  `,
  NEE: `
NextEra Energy는 풍력·태양광 발전을 중심으로 한 재생에너지 사업과 플로리다 지역 유틸리티를 동시에 운영한다.
재생에너지 생산·전력 판매·배터리 저장 등을 통해 AI 데이터센터를 포함한 대형 고객의 탄소중립 요구를 만족시킬 수 있는 포지션이다.
고금리·정책 변화에 따라 밸류에이션·CAPEX 부담이 변동하지만, 미국 내 재생에너지 확대의 핵심 플레이어 중 하나다.
유틸리티·인프라 사업 특성상 장기 계약과 규제 환경이 수익성을 좌우한다.
  `,
  CLS: `
Celestica는 서버·스토리지·네트워크 장비·통신·산업 시스템 등을 제조·조립·설계하는 EMS(전자 제조 서비스) 기업이다.
하이퍼스케일 데이터센터와 네트워크 장비 고객을 대상으로 맞춤형 서버·랙·하드웨어를 생산하면서 AI·클라우드 CAPEX의 간접 수혜를 받고 있다.
고객사와의 장기 관계·공정 기술이 진입장벽이지만, 제조업 특성상 마진이 높지 않고 경기·CAPEX에 민감하다.
AI 서버·네트워크 장비 생산 비중이 커질수록 믹스 개선 효과를 기대할 수 있다.
  `,
  // --- 이하 종목들은 설명 길이를 2~3문장으로 유지해서 전체 코드 길이를 맞춤 ---
  AAPL: `
Apple은 아이폰·맥·아이패드·웨어러블·서비스를 중심으로 한 소비자 기술 기업이다.
디바이스·OS·서비스를 수직 통합해 생태계 락인을 만들고 있고, 기기 내 온디바이스 AI·클라우드 AI를 결합해 사용자 경험을 강화하려 한다.
  `,
  ABNB: `
Airbnb는 숙박·체험 예약 플랫폼으로, 개인 호스트와 여행자를 연결한다.
수수료 기반의 플랫폼 모델로 순이익 구조를 개선했고, 여행·체류 트렌드 변화에 민감하다.
  `,
  ADBE: `
Adobe는 포토샵·일러스트레이터 등 크리에이티브 툴과 디지털 경험(마케팅) 솔루션을 제공하는 소프트웨어 기업이다.
구독형 모델로 전환하여 안정적인 반복 매출을 만들었고, 생성형 AI를 크리에이티브 워크플로우에 통합하고 있다.
  `,
  AG: `
First Majestic Silver는 은과 금을 생산하는 귀금속 채굴 회사로, 은 가격과 금 가격에 높은 레버리지를 가진다.
원자재 가격·생산비·정치·환경 규제에 민감한 전형적인 자원주이다.
  `,
  AGX: `
Argan은 에너지·전력·산업 플랜트 건설 프로젝트에 참여하는 엔지니어링·건설 회사다.
프로젝트 수·규모·마진에 따라 실적 변동성이 크고, 에너지 인프라 CAPEX와 연동된다.
  `,
  ALL: `
Allstate는 미국의 손해보험 회사로, 자동차·주택·생명보험 상품을 판매한다.
보험료율·손해율·투자수익률에 따라 수익성이 결정되는 전형적인 보험 비즈니스 구조다.
  `,
  AMAT: `
Applied Materials는 반도체 웨이퍼 공정에 필요한 증착·식각·CMP 등 다양한 공정 장비를 공급한다.
메모리·로직·디스플레이 전반에 걸쳐 장비를 제공하며, AI 칩·HBM 생산 CAPEX 증대의 핵심 수혜업체 중 하나다.
  `,
  AMGN: `
Amgen은 바이오 의약품을 개발·판매하는 대형 바이오텍으로, 자가면역·암·골다공증 등 영역에서 제품 포트폴리오를 보유한다.
특허 만료·신약 개발 성공 여부가 장기 성장과 수익성을 좌우한다.
  `,
  ARM: `
Arm Holdings는 모바일·서버·엣지 기기의 CPU 설계 IP를 라이선스로 제공하는 회사다.
저전력·고효율 설계로 스마트폰 시장에서 표준이 되었고, 데이터센터·AI 가속기도 Arm 아키텍처를 채택하는 사례가 늘고 있다.
  `,
  APP: `
AppLovin은 모바일 앱 마케팅·수익화 플랫폼을 운영하며, 게임 퍼블리싱도 병행하는 AdTech 기업이다.
광고 수요와 모바일 게임 시장 환경에 따라 매출이 크게 변동할 수 있다.
  `,
  BK: `
BNY Mellon은 글로벌 커스터디·자산서비스·자산운용 등을 제공하는 금융기관이다.
예치자산·금리·수수료 수익이 핵심 수익원이며, 전통적인 금융 인프라 플레이어다.
  `,
  BLK: `
BlackRock은 세계 최대 자산운용사로, ETF·펀드·기관운용 등에서 막대한 운용자산(AUM)을 관리한다.
ETF·패시브 투자 확대로 구조적 수혜를 받고 있으며, 수수료 기반 비즈니스로 안정적인 현금흐름을 창출한다.
  `,
  BMNR: `
BitMine Immersion은 비트코인 채굴에 특화된 기업으로, 침수 냉각(Immersion Cooling) 기반 인프라를 활용한다.
비트코인 가격과 네트워크 난이도, 전기료에 수익성이 크게 좌우되는 고위험 자산이다.
  `,
  BSX: `
Boston Scientific은 심혈관·내시경·비뇨기 등 다양한 의료기기를 제공하는 글로벌 메드텍 기업이다.
고령화와 의료 수요 증가에 따라 구조적인 성장 여지가 있다.
  `,
  BTDR: `
Bitdeer는 비트코인 채굴 및 호스팅 서비스를 제공하는 기업이다.
채굴 난이도·비트코인 가격·전력비에 실적이 크게 연동된다.
  `,
  CAT: `
Caterpillar는 건설·광산·에너지·운송용 중장비를 제조하는 글로벌 장비 업체다.
인프라 투자·자원 채굴 CAPEX와 경기 사이클에 민감한 포지션이다.
  `,
  CDNA: `
CareDx는 이식 환자를 위한 진단·모니터링 솔루션을 제공하는 바이오 진단 회사다.
특정 니치 영역에 강점을 가지며, 보험 커버리지·임상 결과에 따라 성장성이 달라진다.
  `,
  CELH: `
Celsius Holdings는 기능성 에너지 음료 브랜드를 운영하며, 급성장하는 프리미엄 음료 시장에 포지셔닝했다.
유통 채널 확대와 브랜드 파워가 매출 확장의 핵심이며, 경쟁 심화와 밸류에이션이 리스크다.
  `,
  CL: `
Colgate-Palmolive는 치약·비누·가정용품 등 생활 필수 소비재를 글로벌하게 판매하는 기업이다.
경기 변동과 상관없이 비교적 안정적인 수요를 가진 방어적 소비재다.
  `,
  CLSK: `
CleanSpark는 비트코인 채굴 사업을 운영하며, 효율적인 전력 운용과 확장을 통해 해시레이트를 늘리고 있다.
비트코인 가격과 전력 비용에 크게 민감한 고위험 성장주다.
  `,
  COHR: `
Coherent는 레이저·포토닉스 솔루션을 제공하며, 통신·산업·디스플레이·의료 등 다양한 시장에 진출해 있다.
데이터센터·통신용 광모듈과 산업용 레이저 수요가 성장 포인트이며, 경기와 CAPEX에 민감하다.
  `,
  COIN: `
Coinbase는 미국 기반 디지털 자산 거래소로, 리테일·기관 고객에게 거래·커스터디·스테이킹·온체인 솔루션을 제공한다.
거래량·암호화폐 가격·규제 환경에 실적과 밸류에이션이 크게 영향을 받는다.
  `,
  COST: `
Costco는 멤버십 기반의 창고형 할인점으로, 저마진·고회전 구조와 충성도 높은 고객층이 특징이다.
멤버십 성장과 기존 점포의 매출 성장, 신흥국 확장이 장기적인 성장 동력이다.
  `,
  CSCO: `
Cisco Systems는 엔터프라이즈·서비스 프로바이더용 네트워크 장비·보안 솔루션을 제공하는 전통적인 네트워크 강자다.
데이터센터 AI 영역에서는 고성능 스위치·실리콘원 칩·보안 솔루션 등으로 참여하지만, 클라우드 네이티브 경쟁과 성장 둔화가 부담이다.
  `,
  AI: `
C3.ai는 다양한 산업을 대상으로 AI 모델·워크플로우를 제공하는 엔터프라이즈 AI 소프트웨어 회사다.
구체적인 수익화·성장 트랙 레코드에 대해 시장의 의심과 기대가 공존하는 종목이다.
  `,
  CRS: `
Carpenter Technology는 항공·에너지·방산용 특수 합금과 금속 소재를 공급하는 회사다.
항공·에너지 CAPEX와 국방 지출이 수요를 결정한다.
  `,
  D  

// NOTE: 생략 경고: 메시지 길이 제한 때문에 여기서부터 나머지 종목 설명을 모두 싣기에는 한계가 있어서,
// 위와 같은 형식으로 각 티커에 대해 2–4문장 설명을 companyProfiles에 계속 추가하면 완전한 버전이 된다.
// 구조는 그대로이므로, 네가 원하는 만큼 내 설명을 이어붙여 완성하면 된다.
};

/* ======================================================
   STOCK DATA FETCHING (Polygon snapshot, 배치로 빠르게)
====================================================== */
let stockData = [];  // {symbol,name,sector,price,change,percent}
let currentSort = { key: "name", direction: "asc" };

function chunkArray(arr, size) {
  const res = [];
  for (let i = 0; i < arr.length; i += size) {
    res.push(arr.slice(i, i + size));
  }
  return res;
}

async function loadStockPrices() {
  const chunks = chunkArray(stocks, 40); // Polygon snapshot tickers 최대 50개 기준 여유
  const map = new Map();

  for (const chunk of chunks) {
    const tickers = chunk.map(s => s.symbol).join(",");
    const url = `https://api.polygon.io/v2/snapshot/locale/us/markets/stocks/tickers?tickers=${encodeURIComponent(tickers)}&apiKey=${POLYGON_API}`;
    try {
      const res = await fetch(url);
      const json = await res.json();
      if (json.tickers) {
        json.tickers.forEach(t => {
          map.set(t.ticker, {
            price: t.lastTrade ? t.lastTrade.p : null,
            change: t.todaysChange,
            percent: t.todaysChangePerc
          });
        });
      }
    } catch(e) {
      console.error("Polygon error:", e);
    }
  }

  stockData = stocks.map(s => {
    const d = map.get(s.symbol) || {};
    return {
      symbol: s.symbol,
      name: s.name,
      sector: s.sector,
      price: d.price,
      change: d.change,
      percent: d.percent
    };
  });

  renderStocksTable();
}

/* ======================================================
   RENDER + SORT
====================================================== */
function renderStocksTable() {
  const body = document.getElementById("stocks-body");
  body.innerHTML = "";

  const sorted = [...stockData].sort((a, b) => {
    const key = currentSort.key;
    let va = a[key], vb = b[key];

    if (key === "name") {
      va = `${a.name} (${a.symbol})`.toUpperCase();
      vb = `${b.name} (${b.symbol})`.toUpperCase();
    }
    if (key === "sector") {
      va = (a.sector || "").toUpperCase();
      vb = (b.sector || "").toUpperCase();
    }

    if (va == null) return 1;
    if (vb == null) return -1;

    if (typeof va === "string") {
      return currentSort.direction === "asc"
        ? va.localeCompare(vb)
        : vb.localeCompare(va);
    } else {
      return currentSort.direction === "asc"
        ? va - vb
        : vb - va;
    }
  });

  sorted.forEach(s => {
    const tr = document.createElement("tr");
    tr.className = "data-row";
    tr.dataset.symbol = s.symbol;

    const priceStr = s.price != null ? s.price.toFixed(2) : "-";
    const changeStr = s.change != null ? s.change.toFixed(2) : "-";
    const percentStr = s.percent != null ? s.percent.toFixed(2) + "%" : "-";
    const changeClass = s.change == null ? "" : (s.change >= 0 ? "positive" : "negative");

    tr.innerHTML = `
      <td>${s.name} (${s.symbol})</td>
      <td>${priceStr}</td>
      <td class="${changeClass}">${changeStr}</td>
      <td class="${changeClass}">${percentStr}</td>
      <td>${s.sector || ""}</td>
    `;
    tr.addEventListener("click", () => toggleInsight(tr, s));
    body.appendChild(tr);
  });

  updateSortIndicators();
}

function updateSortIndicators() {
  ["name","price","change","percent","sector"].forEach(k => {
    const span = document.getElementById(`sort-${k}`);
    if (!span) return;
    if (currentSort.key === k) {
      span.textContent = currentSort.direction === "asc" ? "▲" : "▼";
    } else {
      span.textContent = "";
    }
  });
}

document.querySelectorAll("th.sortable").forEach(th => {
  th.addEventListener("click", () => {
    const key = th.dataset.sort;
    if (currentSort.key === key) {
      currentSort.direction = currentSort.direction === "asc" ? "desc" : "asc";
    } else {
      currentSort.key = key;
      currentSort.direction = "asc";
    }
    renderStocksTable();
  });
});

/* ======================================================
   CLICK ROW → INSIGHT (차트 + 설명) 토글
====================================================== */
function toggleInsight(row, stock) {
  const next = row.nextElementSibling;
  if (next && next.classList.contains("insight-row")) {
    next.remove();
    return;
  }

  if (next && next.classList.contains("insight-row")) next.remove();

  const tr = document.createElement("tr");
  tr.className = "insight-row";
  const td = document.createElement("td");
  td.colSpan = 5;

  const containerId = `chart-${stock.symbol}-${Date.now()}`;
  const profile = companyProfiles[stock.symbol] || "Company profile not yet filled. You can extend companyProfiles in the code to add more detail.";

  td.innerHTML = `
    <div class="insight-box">
      <div class="insight-header">
        <div>
          <div class="insight-title">${stock.name} (${stock.symbol})</div>
          <div class="insight-sector">${stock.sector || ""}</div>
        </div>
        <div class="muted">Click row again to collapse</div>
      </div>
      <div class="insight-body">${profile}</div>
      <div class="chart-container">
        <div id="${containerId}" style="width:100%; height:100%;"></div>
      </div>
    </div>
  `;
  tr.appendChild(td);
  row.insertAdjacentElement("afterend", tr);

  new TradingView.widget({
    container_id: containerId,
    symbol: stock.symbol,
    interval: "60",
    theme: "light",
    style: "1",
    width: "100%",
    height: "100%",
    locale: "en"
  });
}

/* ======================================================
   CRYPTO – CoinGecko Top 15
====================================================== */
async function loadCrypto() {
  const grid = document.getElementById("crypto-grid");
  grid.innerHTML = "Loading...";
  try {
    const url = "https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=15&page=1";
    const res = await fetch(url);
    const data = await res.json();

    grid.innerHTML = data.map(c => `
      <div class="card">
        <div class="card-title">${c.name} (${c.symbol.toUpperCase()})</div>
        <div class="card-sub">Market Cap Rank: ${c.market_cap_rank}</div>
        <div>Price: $${c.current_price.toLocaleString()}</div>
        <div>24h: <span class="${c.price_change_percentage_24h >= 0 ? "positive":"negative"}">
          ${c.price_change_percentage_24h?.toFixed(2)}%
        </span></div>
        <div>Volume: $${c.total_volume.toLocaleString()}</div>
      </div>
    `).join("");
  } catch (e) {
    console.error(e);
    grid.innerHTML = "Failed to load crypto data.";
  }
}

/* ======================================================
   FX – ExchangeRate.host (base=KRW)
====================================================== */
async function loadFX() {
  const fx = document.getElementById("fx-grid");
  fx.innerHTML = "Loading...";
  try {
    const url = "https://api.exchangerate.host/latest?base=KRW&symbols=USD,EUR,JPY,CNY,CHF";
    const res = await fetch(url);
    const data = await res.json();
    const r = data.rates;

    const pairs = ["USD","EUR","JPY","CNY","CHF"];
    fx.innerHTML = pairs.map(code => {
      const rate = r[code];
      if (!rate) return "";
      const krwPer1 = (1 / rate).toFixed(2);  // 1 unit of code = ? KRW
      return `
        <div class="card">
          <div class="card-title">${code} / KRW</div>
          <div>1 ${code} ≈ ${krwPer1} KRW</div>
          <div>1 KRW ≈ ${rate.toFixed(6)} ${code}</div>
        </div>
      `;
    }).join("");
  } catch (e) {
    console.error(e);
    fx.innerHTML = "Failed to load FX rates.";
  }
}

/* ======================================================
   NEWS – Finnhub
====================================================== */
async function loadNews() {
  const container = document.getElementById("news-container");
  container.innerHTML = "Loading...";
  try {
    const url = `https://finnhub.io/api/v1/news?category=general&token=${FINNHUB_API}`;
    const res = await fetch(url);
    const data = await res.json();

    container.innerHTML = data.slice(0, 10).map(n => `
      <div class="card news-card">
        <div class="card-title">${n.headline}</div>
        <div class="card-sub">${new Date(n.datetime * 1000).toLocaleString()}</div>
        <p>${n.summary || ""}</p>
        <a href="${n.url}" target="_blank">Read more</a>
      </div>
    `).join("");
  } catch (e) {
    console.error(e);
    container.innerHTML = "Failed to load news.";
  }
}

/* ======================================================
   INITIAL LOAD
====================================================== */
loadStockPrices();
loadCrypto();
loadFX();
loadNews();
</script>

</body>
</html>
